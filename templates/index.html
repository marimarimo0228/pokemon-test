<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒã‚±ãƒ¢ãƒ³å¯¾æˆ¦æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ </title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; }
        .card { box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body class="container py-4">
    <h1 class="text-center mb-5 text-primary">ãƒã‚±ãƒ¢ãƒ³å¯¾æˆ¦æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ </h1>

    <div class="row g-4">
        <div class="col-lg-6">
            <div class="card h-100">
                <div class="card-header bg-white fw-bold">æ‰‹æŒã¡ãƒã‚±ãƒ¢ãƒ³ã®ç®¡ç†</div>
                <div class="card-body">
                    <form action="/add" method="POST" class="mb-4 d-flex gap-2">
                        <select name="pokemon_id" class="form-select">
                            <option value="">ãƒã‚±ãƒ¢ãƒ³ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                            {% for p in all_pokemon %}
                            <option value="{{ p.pokemon_id }}">
                                {{ p.pokemon_name }} ({{ p.type.type_name }})
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-primary text-nowrap">ç™»éŒ²</button>
                    </form>

                    <h5>ç¾åœ¨ã®æ‰‹æŒã¡</h5>
                    <div class="table-responsive">
                        <table class="table table-striped align-middle">
                            <thead>
                                <tr>
                                    <th>åå‰/ã‚¿ã‚¤ãƒ—</th>
                                    <th>ãƒ¡ãƒ¢ (Update)</th>
                                    <th>æ“ä½œ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for p in my_party %}
                                <tr>
                                    <td>
                                        <div><strong>{{ p.pokemon.pokemon_name }}</strong></div>
                                        <span class="badge bg-secondary">{{ p.pokemon.type.type_name }}</span>
                                    </td>
                                    <td>
                                        <form action="/update/{{ p.user_pokemon_id }}" method="POST" class="d-flex">
                                            <input type="text" name="memo" value="{{ p.memo }}" class="form-control form-control-sm me-1" placeholder="ãƒ¡ãƒ¢">
                                            <button type="submit" class="btn btn-sm btn-success">ä¿å­˜</button>
                                        </form>
                                    </td>
                                    <td>
                                        <form action="/delete/{{ p.user_pokemon_id }}" method="POST">
                                            <button type="submit" class="btn btn-sm btn-danger">å‰Šé™¤</button>
                                        </form>
                                    </td>
                                </tr>
                                {% endfor %}
                                {% if not my_party %}
                                <tr><td colspan="3" class="text-center text-muted">æ‰‹æŒã¡ãƒã‚±ãƒ¢ãƒ³ãŒã„ã¾ã›ã‚“</td></tr>
                                {% endif %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card h-100 border-danger">
                <div class="card-header bg-danger text-white fw-bold">å¯¾æˆ¦è§£æ</div>
                <div class="card-body">
                    <form action="/" method="GET" class="mb-4 d-flex gap-2">
                        <select name="enemy_id" class="form-select">
                            <option value="">å¯¾æˆ¦ç›¸æ‰‹ã‚’é¸æŠã—ã¦ãã ã•ã„</option>
                            {% for p in all_pokemon %}
                            <option value="{{ p.pokemon_id }}" {% if enemy and enemy.pokemon_id == p.pokemon_id %}selected{% endif %}>
                                {{ p.pokemon_name }} ({{ p.type.type_name }})
                            </option>
                            {% endfor %}
                        </select>
                        <button type="submit" class="btn btn-danger text-nowrap">è§£æé–‹å§‹</button>
                    </form>

                    {% if enemy %}
                    <div class="alert alert-warning">
                        <strong>ç›¸æ‰‹: {{ enemy.pokemon_name }}</strong> <br>
                        ã‚¿ã‚¤ãƒ—: <b>{{ enemy.type.type_name }}</b>
                    </div>

                    <h5 class="mb-3">æœ‰åˆ©ãªãƒã‚±ãƒ¢ãƒ³ (åŠ¹æœæŠœç¾¤é †)</h5>
                    {% if results %}
                        <div class="list-group">
                        {% for p_master, eff_row, user_p in results %}
                            <div class="list-group-item d-flex justify-content-between align-items-center">
                                <div>
                                    <h6 class="mb-0">
                                        {{ p_master.pokemon_name }}
                                        {% if user_p.memo %}
                                            <span class="badge bg-warning text-dark ms-2">ğŸ“ {{ user_p.memo }}</span>
                                        {% endif %}
                                    </h6>
                                    <small class="text-muted">
                                        ã‚¿ã‚¤ãƒ—: {{ p_master.type.type_name }} / ç´ æ—©ã•: {{ p_master.speed }}
                                    </small>
                                </div>
                                <span class="badge bg-danger rounded-pill">{{ eff_row.effectiveness }}å€</span>
                            </div>
                        {% endfor %}
                        </div>
                    {% else %}
                        <p class="text-danger">æ‰‹æŒã¡ã®ä¸­ã«æœ‰åˆ©ãªï¼ˆåŠ¹æœæŠœç¾¤ã®ï¼‰ãƒã‚±ãƒ¢ãƒ³ãŒã„ã¾ã›ã‚“ã€‚</p>
                    {% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</body>
</html>
